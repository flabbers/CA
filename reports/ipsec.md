PS C:\data\git\ca\remoterouter> vagrant init
A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.

PS C:\data\git\ca\remoterouter> cat .\Vagrantfile
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  config.vm.define "remoterouter" do |my_machine|
    config.vm.box = "generic-x64/debian12"
    config.vm.hostname = "remoterouter"
    config.vm.network "private_network", virtualbox_intnet: "VirtualBox Host-Only Ethernet Adapter #2", type: "static", ip: "192.168.100.252"
    config.vm.network "private_network", virtualbox__intnet: "remote", type: "static", ip: "172.123.0.254"
    config.vm.provider "virtualbox" do |vb|
      vb.gui = true
      vb.name = "ca_d_remoterouter"
      vb.memory = "1024"
      vb.cpus = "1"
      vb.customize ["modifyvm", :id, "--clipboard-mode", "bidirectional"]
    end
  end
end



PS C:\data\git\ca\remoterouter> vagrant up
Bringing machine 'remoterouter' up with 'virtualbox' provider...
==> remoterouter: Importing base box 'generic-x64/debian12'...
==> remoterouter: Matching MAC address for NAT networking...
==> remoterouter: Checking if box 'generic-x64/debian12' version '4.3.6' is up to date...
==> remoterouter: A newer version of the box 'generic-x64/debian12' for provider 'virtualbox' is
==> remoterouter: available! You currently have version '4.3.6'. The latest is version
==> remoterouter: '4.3.10'. Run `vagrant box update` to update.
==> remoterouter: Setting the name of the VM: ca_d_remoterouter
==> remoterouter: Fixed port collision for 22 => 2222. Now on port 2201.
==> remoterouter: Clearing any previously set network interfaces...
==> remoterouter: Preparing network interfaces based on configuration...
    remoterouter: Adapter 1: nat
    remoterouter: Adapter 2: hostonly
    remoterouter: Adapter 3: intnet
==> remoterouter: Forwarding ports...
    remoterouter: 22 (guest) => 2201 (host) (adapter 1)
==> remoterouter: Running 'pre-boot' VM customizations...
==> remoterouter: Booting VM...
==> remoterouter: Waiting for machine to boot. This may take a few minutes...
    remoterouter: SSH address: 127.0.0.1:2201
    remoterouter: SSH username: vagrant
    remoterouter: SSH auth method: private key
    remoterouter:
    remoterouter: Vagrant insecure key detected. Vagrant will automatically replace
    remoterouter: this with a newly generated keypair for better security.
    remoterouter:
    remoterouter: Inserting generated public key within guest...
    remoterouter: Removing insecure key from the guest if it's present...
    remoterouter: Key inserted! Disconnecting and reconnecting using new SSH key...
==> remoterouter: Machine booted and ready!
==> remoterouter: Checking for guest additions in VM...
==> remoterouter: Setting hostname...
==> remoterouter: Configuring and enabling network interfaces...
PS C:\data\git\ca\remoterouter> vagrant ssh
vagrant@remoterouter:~$ ip -4 a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    altname enp0s3
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic eth0
       valid_lft 86317sec preferred_lft 86317sec
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    altname enp0s8
    inet 192.168.100.252/24 brd 192.168.100.255 scope global eth1
       valid_lft forever preferred_lft forever
4: eth2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    altname enp0s9
    inet 172.123.0.254/24 brd 172.123.0.255 scope global eth2
       valid_lft forever preferred_lft forever
vagrant@remoterouter:~$ ping 192.168.100.253
PING 192.168.100.253 (192.168.100.253) 56(84) bytes of data.
64 bytes from 192.168.100.253: icmp_seq=1 ttl=64 time=0.444 ms
64 bytes from 192.168.100.253: icmp_seq=2 ttl=64 time=1.07 ms
64 bytes from 192.168.100.253: icmp_seq=3 ttl=64 time=0.972 ms
^C
--- 192.168.100.253 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2012ms
rtt min/avg/max/mdev = 0.444/0.829/1.073/0.275 ms
vagrant@remoterouter:~$ ip r
default via 10.0.2.2 dev eth0
10.0.2.0/24 dev eth0 proto kernel scope link src 10.0.2.15
172.123.0.0/24 dev eth2 proto kernel scope link src 172.123.0.254
192.168.100.0/24 dev eth1 proto kernel scope link src 192.168.100.252
vagrant@remoterouter:~$ cat /etc/resolv.conf
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
# 127.0.0.53 is the systemd-resolved stub resolver.
# run "resolvectl status" to see details about the actual nameservers.

nameserver 4.2.2.1
nameserver 4.2.2.2
nameserver 208.67.220.220
search home
vagrant@remoterouter:~$ nslookup www.google.be
Server:         4.2.2.1
Address:        4.2.2.1#53

Non-authoritative answer:
Name:   www.google.be
Address: 142.250.187.163
Name:   www.google.be
Address: 2a00:1450:4017:812::2003

vagrant@remoterouter:~$ exit
logout
Connection to 127.0.0.1 closed.
PS C:\data\git\ca\remoterouter>




vagrant@remoterouter:~$ sudo useradd -m -s /bin/bash -p "$(openssl passwd -1 'Friday13th!')" walt
vagrant@remoterouter:~$ sudo cp /etc/sudoers.d/vagrant /etc/sudoers.d/walt
vagrant@remoterouter:~$ sudo sed -i 's/vagrant/walt/g' /etc/sudoers.d/walt
vagrant@remoterouter:~$ sudo cat /etc/sudoers.d/walt
Defaults:walt !fqdn
Defaults:walt !requiretty
walt ALL=(ALL) NOPASSWD: ALL
vagrant@remoterouter:~$ sudo su - walt
walt@remoterouter:~$ whoami
walt
walt@remoterouter:~$ sudo whoami
root
walt@remoterouter:~$ mkdir .ssh
walt@remoterouter:~$ mkdir -p ~/.ssh && chmod 700 ~/.ssh && touch ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys
walt@remoterouter:~$ echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDFI4Qm7YeH2CZQlKcmlpj2U0zpIYT74nRpiVfWnYy9p+vjChA0lF4lZ9XSGevq+ZVHWV3RBzpmcBS5i0XrZSGbEfh6zwsYpAy7K8ErIbSepdNJkBm1jMslGO3E5gabU2tP/+TUpyfrHuuV377IrwQ3XxPOjuCPj0WOwlcFgZovtLc0ZH39ns6O8K3SVYLkho2NdgMXi4gJAlQCOj99kjA+ZT5xhOJ832w2rJn7t8XfS+fgOwoNhErv9Mq6r8c7zyE3eYKkMfk0S24jFyC66fZSu7/LERC/F4ipGGc4MyB9ODu47CAE9knRA358nuB9x4lnklVYP7twPP0iOPrgqLEcYt6fakNaniHCJxmyokINys2NqtjZNDJEBkPBWvOPoRoM555GNIsVpnsJparVmFVoCtMGCUNnvyClRBI90To1t39LMhiN8oTshU0zbuErdkln2iHX4E8czQyfcYkSNtZ0x8FPWBQxzsc/t5UR6NDLHorZTBqbXS0gHH0oxJvVL58= benny.clemmens@student.hogent.be" >> ~/.ssh/authorized_keys
walt@remoterouter:~$ exit
logout
vagrant@remoterouter:~$ exit
logout
Connection to 127.0.0.1 closed.


PS C:\data\git\ca\remoterouter> ssh remoterouterD
The authenticity of host 'remoterouter (192.168.100.252)' can't be established.
ECDSA key fingerprint is SHA256:2CoBSKVNHnoOtFioddHAULs1WNe3nAA5oBSVk4Ir5Kw.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'remoterouter,192.168.100.252' (ECDSA) to the list of known hosts.
walt@remoterouter:~$ exit
logout
Connection to remoterouter closed.
PS C:\data\git\ca\remoterouter> ssh remoterouterD
Last login: Sun Jan  7 22:04:10 2024 from 192.168.100.1
walt@remoterouter:~$




PS C:\data\git\ca\remoterouter> ssh remoterouterD sudo poweroff
Connection to remoterouter closed by remote host.

PS C:\data\git\ca\remoterouter> VBoxManage modifyvm "ca_d_remoterouter" --cable-connected1=off

PS C:\data\git\ca\remoterouter> VBoxManage startvm "ca_d_remoterouter" --type headless
Waiting for VM "ca_d_remoterouter" to power on...
VM "ca_d_remoterouter" has been successfully started.
PS C:\data\git\ca\remoterouter> ssh remoterouterD
Last login: Sun Jan  7 22:04:16 2024 from 192.168.100.1
walt@remoterouter:~$


walt@remoterouter:~$ ip -4 a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    altname enp0s8
    inet 192.168.100.252/24 brd 192.168.100.255 scope global eth1
       valid_lft forever preferred_lft forever
4: eth2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    altname enp0s9
    inet 172.123.0.254/24 brd 172.123.0.255 scope global eth2
       valid_lft forever preferred_lft forever
walt@remoterouter:~$ ip r
172.123.0.0/24 dev eth2 proto kernel scope link src 172.123.0.254
192.168.100.0/24 dev eth1 proto kernel scope link src 192.168.100.252
walt@remoterouter:~$ sudo nano /etc/network/interfaces
walt@remoterouter:~$ cat nano /etc/network/interfaces
cat: nano: No such file or directory
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface

# The primary network interface
allow-hotplug eth0
auto lo
iface lo inet loopback
iface eth0 inet dhcp
dns-nameserver 8.8.8.8
dns-nameserver 172.30.0.4

pre-up sleep 2

auto eth1
iface eth1 inet static
      address 192.168.100.252
      netmask 255.255.255.0
      gateway 192.168.100.253

auto eth2
iface eth2 inet static
      address 172.123.0.254
      netmask 255.255.255.0
walt@remoterouter:~$




walt@remoterouter:~$ echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf
net.ipv4.ip_forward=1
walt@remoterouter:~$ sudo sysctl -p
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv4.ip_forward = 1
walt@remoterouter:~$




walt@remoterouter:~$ cat /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface

# The primary network interface
allow-hotplug eth0
auto lo
iface lo inet loopback

iface eth0 inet dhcp

pre-up sleep 2

auto eth1
iface eth1 inet static
      address 192.168.100.252
      netmask 255.255.255.0
      gateway 192.168.100.254
      dns-nameserver 8.8.8.8
      dns-nameserver 172.30.0.4
      up route add -net 172.30.0.0 netmask 255.255.0.0 gw 192.168.100.253
      down route del -net 172.30.0.0 netmask 255.255.0.0 gw 192.168.100.253

auto eth2
iface eth2 inet static
      address 172.123.0.254
      netmask 255.255.255.0


walt@remoterouter:~$ ip -4 a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    altname enp0s8
    inet 192.168.100.252/24 brd 192.168.100.255 scope global eth1
       valid_lft forever preferred_lft forever
4: eth2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    altname enp0s9
    inet 172.123.0.254/24 brd 172.123.0.255 scope global eth2
       valid_lft forever preferred_lft forever
walt@remoterouter:~$ ip r
default via 192.168.100.254 dev eth1 onlink
172.30.0.0/16 via 192.168.100.253 dev eth1
172.123.0.0/24 dev eth2 proto kernel scope link src 172.123.0.254
192.168.100.0/24 dev eth1 proto kernel scope link src 192.168.100.252
walt@remoterouter:~$ tracert 172.30.0.254
-bash: tracert: command not found
walt@remoterouter:~$ traceroute 172.30.0.254
traceroute to 172.30.0.254 (172.30.0.254), 30 hops max, 60 byte packets
 1  172.30.0.254 (172.30.0.254)  0.863 ms  0.839 ms  0.829 ms
walt@remoterouter:~$ traceroute 10.0.2.2
traceroute to 10.0.2.2 (10.0.2.2), 30 hops max, 60 byte packets
 1  192.168.100.254 (192.168.100.254)  0.882 ms  0.918 ms  0.907 ms
 2  10.0.2.2 (10.0.2.2)  4.969 ms  4.877 ms  4.779 ms
walt@remoterouter:~$ nslookup www.hln.be
Server:         8.8.8.8
Address:        8.8.8.8#53

Non-authoritative answer:
www.hln.be      canonical name = dpp-hln-wc.edgekey.net.
dpp-hln-wc.edgekey.net  canonical name = e27717.dscb.akamaiedge.net.
Name:   e27717.dscb.akamaiedge.net
Address: 2.17.196.59
Name:   e27717.dscb.akamaiedge.net
Address: 2.17.196.98
Name:   e27717.dscb.akamaiedge.net
Address: 2a02:26f0:3900::211:c43b
Name:   e27717.dscb.akamaiedge.net
Address: 2a02:26f0:3900::211:c462






PS C:\data\git\ca\remoteclient>  vagrant init
A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.


PS C:\data\git\ca\remoteclient> vagrant up
Bringing machine 'remoteclient' up with 'virtualbox' provider...
==> remoteclient: Importing base box 'ubuntu/focal64'...
==> remoteclient: Matching MAC address for NAT networking...
==> remoteclient: Checking if box 'ubuntu/focal64' version '20231207.0.0' is up to date...
==> remoteclient: Setting the name of the VM: ca_c_remoteclient
==> remoteclient: Fixed port collision for 22 => 2222. Now on port 2202.
==> remoteclient: Clearing any previously set network interfaces...
==> remoteclient: Preparing network interfaces based on configuration...
    remoteclient: Adapter 1: nat
    remoteclient: Adapter 2: intnet
==> remoteclient: Forwarding ports...
    remoteclient: 22 (guest) => 2202 (host) (adapter 1)
==> remoteclient: Running 'pre-boot' VM customizations...
==> remoteclient: Booting VM...
==> remoteclient: Waiting for machine to boot. This may take a few minutes...
    remoteclient: SSH address: 127.0.0.1:2202
    remoteclient: SSH username: vagrant
    remoteclient: SSH auth method: private key
    remoteclient:
    remoteclient: Vagrant insecure key detected. Vagrant will automatically replace
    remoteclient: this with a newly generated keypair for better security.
    remoteclient:
    remoteclient: Inserting generated public key within guest...
    remoteclient: Removing insecure key from the guest if it's present...
    remoteclient: Key inserted! Disconnecting and reconnecting using new SSH key...
==> remoteclient: Machine booted and ready!
==> remoteclient: Checking for guest additions in VM...
    remoteclient: The guest additions on this VM do not match the installed version of
    remoteclient: VirtualBox! In most cases this is fine, but in rare cases it can
    remoteclient: prevent things such as shared folders from working properly. If you see
    remoteclient: shared folder errors, please make sure the guest additions within the
    remoteclient: virtual machine match the version of VirtualBox you have installed on
    remoteclient: your host and reload your VM.
    remoteclient:
    remoteclient: Guest Additions Version: 6.1.38
    remoteclient: VirtualBox Version: 7.0
==> remoteclient: Setting hostname...
==> remoteclient: Configuring and enabling network interfaces...
==> remoteclient: Mounting shared folders...
    remoteclient: /vagrant => C:/DATA/GIT/CA/remoteclient






PS C:\Users\Benny> route -p add 172.123.0.0 mask 255.255.255.0 192.168.100.252
 OK!

PS C:\Users\Benny> route print
...
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
       172.30.0.0      255.255.0.0  192.168.100.253       1
      172.123.0.0    255.255.255.0  192.168.100.252       1
===========================================================================
...



isprouter:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp
    hostname alpine38.localdomain
auto eth1
iface eth1 inet static
  address 192.168.100.254
  netmask 255.255.255.0
  up route add -net 172.30.0.0 netmask 255.255.0.0 gw 192.168.100.253
  down route del -net 172.30.0.0 netmask 255.255.0.0 gw 192.168.100.253
  up route add -net 172.123.0.0 netmask 255.255.255.0 gw 192.168.100.252
  down route del -net 172.123.0.0 netmask 255.255.255.0 gw 192.168.100.252


isprouter:~$ ip r
default via 10.0.2.2 dev eth0 metric 202
10.0.2.0/24 dev eth0 proto kernel scope link src 10.0.2.15
172.30.0.0/16 via 192.168.100.253 dev eth1
172.123.0.0/24 via 192.168.100.252 dev eth1
192.168.100.0/24 dev eth1 proto kernel scope link src 192.168.100.254
isprouter:~$ ping -c4 172.123.0.254
PING 172.123.0.254 (172.123.0.254): 56 data bytes
64 bytes from 172.123.0.254: seq=0 ttl=42 time=0.541 ms
64 bytes from 172.123.0.254: seq=1 ttl=42 time=0.793 ms
64 bytes from 172.123.0.254: seq=2 ttl=42 time=1.008 ms
64 bytes from 172.123.0.254: seq=3 ttl=42 time=0.937 ms

--- 172.123.0.254 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 0.541/0.819/1.008 ms
isprouter:~$

[walt@companyrouter ~]$ ip r
default via 192.168.100.254 dev eth0 proto static metric 100
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown
172.30.0.0/24 dev eth1 proto kernel scope link src 172.30.0.254 metric 101
172.30.10.0/24 dev eth2 proto kernel scope link src 172.30.10.254 metric 102
172.30.20.0/24 dev eth3 proto kernel scope link src 172.30.20.254 metric 103
172.123.0.0/24 via 192.168.100.252 dev eth0 proto static metric 100
192.168.100.0/24 dev eth0 proto kernel scope link src 192.168.100.253 metric 100
[walt@companyrouter ~]$ ping -c4 172.123.0.254
PING 172.123.0.254 (172.123.0.254) 56(84) bytes of data.
64 bytes from 172.123.0.254: icmp_seq=1 ttl=64 time=0.981 ms
64 bytes from 172.123.0.254: icmp_seq=2 ttl=64 time=0.744 ms
64 bytes from 172.123.0.254: icmp_seq=3 ttl=64 time=0.845 ms
64 bytes from 172.123.0.254: icmp_seq=4 ttl=64 time=0.928 ms

--- 172.123.0.254 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3039ms
rtt min/avg/max/mdev = 0.744/0.874/0.981/0.089 ms
[walt@companyrouter ~]$



PS C:\data\git\ca\remoteclient> VBoxManage modifyvm "ca_c_remoteclient" --cable-connected1=off
PS C:\data\git\ca\remoteclient> VBoxManage startvm "ca_c_remoteclient" --type headless
Waiting for VM "ca_c_remoteclient" to power on...
VM "ca_c_remoteclient" has been successfully started.
PS C:\data\git\ca\remoteclient>




vagrant@remoteclient:~$ ip -4 a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    inet 172.123.0.66/24 brd 172.123.0.255 scope global enp0s8
       valid_lft forever preferred_lft forever
vagrant@remoteclient:~$ ip r
default via 172.123.0.254 dev enp0s8 proto static
172.123.0.0/24 dev enp0s8 proto kernel scope link src 172.123.0.66
vagrant@remoteclient:~$ nslookup www.hln.be
Server:         127.0.0.53
Address:        127.0.0.53#53

Non-authoritative answer:
www.hln.be      canonical name = dpp-hln-wc.edgekey.net.
dpp-hln-wc.edgekey.net  canonical name = e27717.dscb.akamaiedge.net.
Name:   e27717.dscb.akamaiedge.net
Address: 2.17.196.59
Name:   e27717.dscb.akamaiedge.net
Address: 2.17.196.98
Name:   e27717.dscb.akamaiedge.net
Address: 2a02:26f0:3900::211:c462
Name:   e27717.dscb.akamaiedge.net
Address: 2a02:26f0:3900::211:c43b

vagrant@remoteclient:~$ cat /etc/resolv.conf
# This file is managed by man:systemd-resolved(8). Do not edit.
#
# This is a dynamic resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists all
# configured search domains.
#
# Run "resolvectl status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs must not access this file directly, but only through the
# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
# replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
options edns0 trust-ad


vagrant@remoteclient:~$ sudo resolvectl status
Global
       LLMNR setting: no
MulticastDNS setting: no
  DNSOverTLS setting: no
      DNSSEC setting: no
    DNSSEC supported: no
          DNSSEC NTA: 10.in-addr.arpa
                      16.172.in-addr.arpa
                      168.192.in-addr.arpa
                      17.172.in-addr.arpa
                      18.172.in-addr.arpa
                      19.172.in-addr.arpa
                      20.172.in-addr.arpa
                      21.172.in-addr.arpa
                      22.172.in-addr.arpa
                      23.172.in-addr.arpa
                      24.172.in-addr.arpa
                      25.172.in-addr.arpa
                      26.172.in-addr.arpa
                      27.172.in-addr.arpa
                      28.172.in-addr.arpa
                      29.172.in-addr.arpa
                      30.172.in-addr.arpa
                      31.172.in-addr.arpa
                      corp
                      d.f.ip6.arpa
                      home
                      internal
                      intranet
                      lan
                      local
                      private
                      test

Link 3 (enp0s8)
      Current Scopes: DNS
DefaultRoute setting: yes
       LLMNR setting: yes
MulticastDNS setting: no
  DNSOverTLS setting: no
      DNSSEC setting: no
    DNSSEC supported: no
  Current DNS Server: 8.8.8.8
         DNS Servers: 8.8.8.8
                      8.8.4.4

Link 2 (enp0s3)
      Current Scopes: none
DefaultRoute setting: no
       LLMNR setting: yes
MulticastDNS setting: no
  DNSOverTLS setting: no
      DNSSEC setting: no
    DNSSEC supported: no
vagrant@remoteclient:~$




vagrant@remoteclient:~$ sudo useradd -m -s /bin/bash -p "$(openssl passwd -1 'Friday13th!')" walt
vagrant@remoteclient:~$ sudo cp /etc/sudoers.d/vagrant /etc/sudoers.d/walt
vagrant@remoteclient:~$ sudo sed -i 's/vagrant/walt/g' /etc/sudoers.d/walt
vagrant@remoteclient:~$ sudo cat /etc/sudoers.d/walt
walt ALL=(ALL) NOPASSWD:ALL
vagrant@remoteclient:~$ sudo su - walt
walt@remoteclient:~$ sudo whoami
root
walt@remoteclient:~$ mkdir -p ~/.ssh && chmod 700 ~/.ssh && touch ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys
walt@remoteclient:~$ echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDFI4Qm7YeH2CZQlKcmlpj2U0zpIYT74nRpiVfWnYy9p+vjChA0lF4lZ9XSGevq+ZVHWV3RBzpmcBS5i0XrZSGbEfh6zwsYpAy7K8ErIbSepdNJkBm1jMslGO3E5gabU2tP/+TUpyfrHuuV377IrwQ3XxPOjuCPj0WOwlcFgZovtLc0ZH39ns6O8K3SVYLkho2NdgMXi4gJAlQCOj99kjA+ZT5xhOJ832w2rJn7t8XfS+fgOwoNhErv9Mq6r8c7zyE3eYKkMfk0S24jFyC66fZSu7/LERC/F4ipGGc4MyB9ODu47CAE9knRA358nuB9x4lnklVYP7twPP0iOPrgqLEcYt6fakNaniHCJxmyokINys2NqtjZNDJEBkPBWvOPoRoM555GNIsVpnsJparVmFVoCtMGCUNnvyClRBI90To1t39LMhiN8oTshU0zbuErdkln2iHX4E8czQyfcYkSNtZ0x8FPWBQxzsc/t5UR6NDLHorZTBqbXS0gHH0oxJvVL58= benny.clemmens@student.hogent.be" >> ~/.ssh/authorized_keys
walt@remoteclient:~$ exit
logout
vagrant@remoteclient:~$ exit
logout
Connection to 172.123.0.66 closed.




vagrant@red:~$ sudo cat /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface

# The primary network interface
allow-hotplug eth0
auto lo
iface lo inet loopback
iface eth0 inet dhcp
#dns-nameserver 10.0.2.3
pre-up sleep 2
auto eth1
iface eth1 inet static
      address 192.168.100.166
      netmask 255.255.255.0
      dns-nameserver 8.8.8.8
      gateway 192.168.100.254
      up route add -net 172.30.0.0 netmask 255.255.0.0 gw 192.168.100.253
      down route del -net 172.30.0.0 netmask 255.255.0.0 gw 192.168.100.253
      up route add -net 172.123.0.0 netmask 255.255.255.0 gw 192.168.100.252
      down route del -net 172.123.0.0 netmask 255.255.255.0 gw 192.168.100.252


vagrant@red:~$ ip r
default via 192.168.100.254 dev eth1 onlink
172.30.0.0/16 via 192.168.100.253 dev eth1
172.123.0.0/24 via 192.168.100.252 dev eth1
192.168.100.0/24 dev eth1 proto kernel scope link src 192.168.100.166




[walt@companyrouter ~]$ ip neigh
172.30.0.66 dev eth1 FAILED
172.30.0.4 dev eth1 FAILED
192.168.100.254 dev eth0 lladdr 08:00:27:e6:60:9c STALE
172.30.20.10 dev eth3 lladdr 08:00:27:40:38:29 STALE
172.30.0.15 dev eth1 FAILED
192.168.100.252 dev eth0 lladdr 08:00:27:58:75:20 STALE
192.168.100.166 dev eth0 lladdr 08:00:27:47:e5:58 STALE
192.168.100.1 dev eth0 lladdr 0a:00:27:00:00:19 REACHABLE

[walt@companyrouter ~]$ ip link | grep -A1 eth0
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:2e:6b:e6 brd ff:ff:ff:ff:ff:ff
[walt@companyrouter ~]$ ip a | grep eth0
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    inet 192.168.100.253/24 brd 192.168.100.255 scope global noprefixroute eth0



isprouter:~$ arp -n
? (10.0.2.2) at 52:54:00:12:35:02 [ether]  on eth0
? (10.0.2.3) at 52:54:00:12:35:03 [ether]  on eth0
? (192.168.100.1) at 0a:00:27:00:00:19 [ether]  on eth1
? (192.168.100.166) at 08:00:27:47:e5:58 [ether]  on eth1
? (192.168.100.252) at 08:00:27:58:75:20 [ether]  on eth1
? (192.168.100.253) at 08:00:27:2e:6b:e6 [ether]  on eth1
isprouter:~$ ip neigh
10.0.2.2 dev eth0 lladdr 52:54:00:12:35:02 DELAY
10.0.2.3 dev eth0 lladdr 52:54:00:12:35:03 STALE
192.168.100.1 dev eth1 lladdr 0a:00:27:00:00:19 REACHABLE
192.168.100.166 dev eth1 lladdr 08:00:27:47:e5:58 STALE
192.168.100.252 dev eth1 lladdr 08:00:27:58:75:20 STALE
192.168.100.253 dev eth1 lladdr 08:00:27:2e:6b:e6 STALE


walt@remoterouter:~$ arp -n
-bash: arp: command not found
walt@remoterouter:~$ ip neigh
192.168.100.166 dev eth1 lladdr 08:00:27:47:e5:58 STALE
192.168.100.1 dev eth1 lladdr 0a:00:27:00:00:19 REACHABLE
192.168.100.253 dev eth1 lladdr 08:00:27:2e:6b:e6 STALE
172.123.0.66 dev eth2 lladdr 08:00:27:99:d0:39 STALE
192.168.100.254 dev eth1 lladdr 08:00:27:e6:60:9c STALE


vagrant@red:~$ sudo nmap -sn 192.168.100.0/24
Starting Nmap 7.93 ( https://nmap.org ) at 2024-01-07 23:54 UTC
Nmap scan report for 192.168.100.1
Host is up (0.00044s latency).
MAC Address: 0A:00:27:00:00:19 (Unknown)
Nmap scan report for 192.168.100.252
Host is up (0.00064s latency).
MAC Address: 08:00:27:58:75:20 (Oracle VirtualBox virtual NIC)
Nmap scan report for companyrouter (192.168.100.253)
Host is up (0.00063s latency).
MAC Address: 08:00:27:2E:6B:E6 (Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.100.254
Host is up (0.00061s latency).
MAC Address: 08:00:27:E6:60:9C (Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.100.166
Host is up.
Nmap done: 256 IP addresses (5 hosts up) scanned in 1.94 seconds



vagrant@red:~$ sudo apt install -yq ettercap-text-only
Reading package lists...
Building dependency tree...
Reading state information...
The following additional packages will be installed:
  ethtool ettercap-common geoip-database libgeoip1 libluajit-5.1-2 libluajit-5.1-common libnet1 sgml-base
Suggested packages:
  geoip-bin sgml-base-doc
The following NEW packages will be installed:
  ethtool ettercap-common ettercap-text-only geoip-database libgeoip1 libluajit-5.1-2 libluajit-5.1-common libnet1 sgml-base
0 upgraded, 9 newly installed, 0 to remove and 35 not upgraded.
Need to get 3,707 kB of archives.
After this operation, 13.0 MB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bookworm/main amd64 sgml-base all 1.31 [15.4 kB]
Get:2 http://deb.debian.org/debian bookworm/main amd64 ethtool amd64 1:6.1-1 [197 kB]
Get:3 http://deb.debian.org/debian bookworm/main amd64 geoip-database all 20230203-1 [2,222 kB]
Get:4 http://deb.debian.org/debian bookworm/main amd64 libgeoip1 amd64 1.6.12-10 [84.8 kB]
Get:5 http://deb.debian.org/debian bookworm/main amd64 libluajit-5.1-common all 2.1.0~beta3+git20220320+dfsg-4.1 [49.8 kB]
Get:6 http://deb.debian.org/debian bookworm/main amd64 libluajit-5.1-2 amd64 2.1.0~beta3+git20220320+dfsg-4.1 [258 kB]
Get:7 http://deb.debian.org/debian bookworm/main amd64 libnet1 amd64 1.1.6+dfsg-3.2 [60.3 kB]
Get:8 http://deb.debian.org/debian bookworm/main amd64 ettercap-common amd64 1:0.8.3.1-11 [728 kB]
Get:9 http://deb.debian.org/debian bookworm/main amd64 ettercap-text-only amd64 1:0.8.3.1-11 [91.2 kB]
Fetched 3,707 kB in 0s (8,289 kB/s)
Selecting previously unselected package sgml-base.
(Reading database ... 60086 files and directories currently installed.)
Preparing to unpack .../0-sgml-base_1.31_all.deb ...
Unpacking sgml-base (1.31) ...
Selecting previously unselected package ethtool.
Preparing to unpack .../1-ethtool_1%3a6.1-1_amd64.deb ...
Unpacking ethtool (1:6.1-1) ...
Selecting previously unselected package geoip-database.
Preparing to unpack .../2-geoip-database_20230203-1_all.deb ...
Unpacking geoip-database (20230203-1) ...
Selecting previously unselected package libgeoip1:amd64.
Preparing to unpack .../3-libgeoip1_1.6.12-10_amd64.deb ...
Unpacking libgeoip1:amd64 (1.6.12-10) ...
Selecting previously unselected package libluajit-5.1-common.
Preparing to unpack .../4-libluajit-5.1-common_2.1.0~beta3+git20220320+dfsg-4.1_all.deb ...
Unpacking libluajit-5.1-common (2.1.0~beta3+git20220320+dfsg-4.1) ...
Selecting previously unselected package libluajit-5.1-2:amd64.
Preparing to unpack .../5-libluajit-5.1-2_2.1.0~beta3+git20220320+dfsg-4.1_amd64.deb ...
Unpacking libluajit-5.1-2:amd64 (2.1.0~beta3+git20220320+dfsg-4.1) ...
Selecting previously unselected package libnet1:amd64.
Preparing to unpack .../6-libnet1_1.1.6+dfsg-3.2_amd64.deb ...
Unpacking libnet1:amd64 (1.1.6+dfsg-3.2) ...
Selecting previously unselected package ettercap-common.
Preparing to unpack .../7-ettercap-common_1%3a0.8.3.1-11_amd64.deb ...
Unpacking ettercap-common (1:0.8.3.1-11) ...
Selecting previously unselected package ettercap-text-only.
Preparing to unpack .../8-ettercap-text-only_1%3a0.8.3.1-11_amd64.deb ...
Unpacking ettercap-text-only (1:0.8.3.1-11) ...
Setting up libluajit-5.1-common (2.1.0~beta3+git20220320+dfsg-4.1) ...
Setting up libgeoip1:amd64 (1.6.12-10) ...
Setting up sgml-base (1.31) ...
Setting up geoip-database (20230203-1) ...
Setting up ethtool (1:6.1-1) ...
Setting up libnet1:amd64 (1.1.6+dfsg-3.2) ...
Setting up libluajit-5.1-2:amd64 (2.1.0~beta3+git20220320+dfsg-4.1) ...
Setting up ettercap-common (1:0.8.3.1-11) ...
Setting up ettercap-text-only (1:0.8.3.1-11) ...
Processing triggers for man-db (2.11.2-2) ...
Processing triggers for libc-bin (2.36-9+deb12u3) ...
vagrant@red:~$ sudo apt install -yq bettercap
Reading package lists...
Building dependency tree...
Reading state information...
The following additional packages will be installed:
  iptables iw libip6tc2 libnetfilter-conntrack3 libnetfilter-queue1 libnfnetlink0 libnl-3-200 libnl-genl-3-200 wireless-regdb
Suggested packages:
  firewalld
The following NEW packages will be installed:
  bettercap iptables iw libip6tc2 libnetfilter-conntrack3 libnetfilter-queue1 libnfnetlink0 libnl-3-200 libnl-genl-3-200 wireless-regdb
0 upgraded, 10 newly installed, 0 to remove and 35 not upgraded.
Need to get 7,448 kB of archives.
After this operation, 28.6 MB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bookworm/main amd64 libip6tc2 amd64 1.8.9-2 [19.4 kB]
Get:2 http://deb.debian.org/debian bookworm/main amd64 libnfnetlink0 amd64 1.0.2-2 [15.1 kB]
Get:3 http://deb.debian.org/debian bookworm/main amd64 libnetfilter-conntrack3 amd64 1.0.9-3 [40.7 kB]
Get:4 http://deb.debian.org/debian bookworm/main amd64 iptables amd64 1.8.9-2 [360 kB]
Get:5 http://deb.debian.org/debian bookworm/main amd64 libnl-3-200 amd64 3.7.0-0.2+b1 [63.1 kB]
Get:6 http://deb.debian.org/debian bookworm/main amd64 libnl-genl-3-200 amd64 3.7.0-0.2+b1 [21.6 kB]
Get:7 http://deb.debian.org/debian bookworm/main amd64 iw amd64 5.19-1 [104 kB]
Get:8 http://deb.debian.org/debian bookworm/main amd64 libnetfilter-queue1 amd64 1.0.5-3 [14.7 kB]
Get:9 http://deb.debian.org/debian bookworm/main amd64 bettercap amd64 2.32.0-1+b9 [6,796 kB]
Get:10 http://deb.debian.org/debian bookworm/main amd64 wireless-regdb all 2022.06.06-1 [13.1 kB]
Fetched 7,448 kB in 1s (12.2 MB/s)
Selecting previously unselected package libip6tc2:amd64.
(Reading database ... 60328 files and directories currently installed.)
Preparing to unpack .../0-libip6tc2_1.8.9-2_amd64.deb ...
Unpacking libip6tc2:amd64 (1.8.9-2) ...
Selecting previously unselected package libnfnetlink0:amd64.
Preparing to unpack .../1-libnfnetlink0_1.0.2-2_amd64.deb ...
Unpacking libnfnetlink0:amd64 (1.0.2-2) ...
Selecting previously unselected package libnetfilter-conntrack3:amd64.
Preparing to unpack .../2-libnetfilter-conntrack3_1.0.9-3_amd64.deb ...
Unpacking libnetfilter-conntrack3:amd64 (1.0.9-3) ...
Selecting previously unselected package iptables.
Preparing to unpack .../3-iptables_1.8.9-2_amd64.deb ...
Unpacking iptables (1.8.9-2) ...
Selecting previously unselected package libnl-3-200:amd64.
Preparing to unpack .../4-libnl-3-200_3.7.0-0.2+b1_amd64.deb ...
Unpacking libnl-3-200:amd64 (3.7.0-0.2+b1) ...
Selecting previously unselected package libnl-genl-3-200:amd64.
Preparing to unpack .../5-libnl-genl-3-200_3.7.0-0.2+b1_amd64.deb ...
Unpacking libnl-genl-3-200:amd64 (3.7.0-0.2+b1) ...
Selecting previously unselected package iw.
Preparing to unpack .../6-iw_5.19-1_amd64.deb ...
Unpacking iw (5.19-1) ...
Selecting previously unselected package libnetfilter-queue1:amd64.
Preparing to unpack .../7-libnetfilter-queue1_1.0.5-3_amd64.deb ...
Unpacking libnetfilter-queue1:amd64 (1.0.5-3) ...
Selecting previously unselected package bettercap.
Preparing to unpack .../8-bettercap_2.32.0-1+b9_amd64.deb ...
Unpacking bettercap (2.32.0-1+b9) ...
Selecting previously unselected package wireless-regdb.
Preparing to unpack .../9-wireless-regdb_2022.06.06-1_all.deb ...
Unpacking wireless-regdb (2022.06.06-1) ...
Setting up libip6tc2:amd64 (1.8.9-2) ...
Setting up wireless-regdb (2022.06.06-1) ...
update-alternatives: using /lib/firmware/regulatory.db-debian to provide /lib/firmware/regulatory.db (regulatory.db) in auto mode
Setting up libnfnetlink0:amd64 (1.0.2-2) ...
Setting up libnl-3-200:amd64 (3.7.0-0.2+b1) ...
Setting up libnetfilter-queue1:amd64 (1.0.5-3) ...
Setting up libnetfilter-conntrack3:amd64 (1.0.9-3) ...
Setting up libnl-genl-3-200:amd64 (3.7.0-0.2+b1) ...
Setting up iw (5.19-1) ...
Setting up iptables (1.8.9-2) ...
update-alternatives: using /usr/sbin/iptables-legacy to provide /usr/sbin/iptables (iptables) in auto mode
update-alternatives: using /usr/sbin/ip6tables-legacy to provide /usr/sbin/ip6tables (ip6tables) in auto mode
update-alternatives: using /usr/sbin/iptables-nft to provide /usr/sbin/iptables (iptables) in auto mode
update-alternatives: using /usr/sbin/ip6tables-nft to provide /usr/sbin/ip6tables (ip6tables) in auto mode
update-alternatives: using /usr/sbin/arptables-nft to provide /usr/sbin/arptables (arptables) in auto mode
update-alternatives: using /usr/sbin/ebtables-nft to provide /usr/sbin/ebtables (ebtables) in auto mode
Setting up bettercap (2.32.0-1+b9) ...
Created symlink /etc/systemd/system/multi-user.target.wants/bettercap.service → /lib/systemd/system/bettercap.service.
Processing triggers for libc-bin (2.36-9+deb12u3) ...
Processing triggers for man-db (2.11.2-2) ...



vagrant@red:~$ sudo bettercap
bettercap v2.32.0 (built for linux amd64 with go1.19.8) [type 'help' for a list of commands]

192.168.100.0/24 > 192.168.100.166  » [00:08:20] [sys.log] [inf] gateway monitor started ...
192.168.100.0/24 > 192.168.100.166  » net.probe on
192.168.100.0/24 > 192.168.100.166  » [00:08:54] [sys.log] [inf] net.probe starting net.recon as a requirement for net.probe
192.168.100.0/24 > 192.168.100.166  » [00:08:54] [sys.log] [inf] net.probe probing 256 addresses on 192.168.100.0/24
192.168.100.0/24 > 192.168.100.166  » [00:08:54] [endpoint.new] endpoint 192.168.100.1 detected as 0a:00:27:00:00:19.
192.168.100.0/24 > 192.168.100.166  » [00:08:57] [endpoint.new] endpoint 192.168.100.252 detected as 08:00:27:58:75:20 (PCS Computer Systems GmbH).
192.168.100.0/24 > 192.168.100.166  » [00:08:57] [endpoint.new] endpoint 192.168.100.253 (companyrouter) detected as 08:00:27:2e:6b:e6 (PCS Computer Systems GmbH).
192.168.100.0/24 > 192.168.100.166  »


192.168.100.0/24 > 192.168.100.166  » net.show

┌─────────────────┬───────────────────┬───────────────┬───────────────────────────┬────────┬────────┬──────────┐
│      IP ▴       │        MAC        │     Name      │          Vendor           │  Sent  │ Recvd  │   Seen   │
├─────────────────┼───────────────────┼───────────────┼───────────────────────────┼────────┼────────┼──────────┤
│ 192.168.100.166 │ 08:00:27:47:e5:58 │ eth1          │ PCS Computer Systems GmbH │ 0 B    │ 0 B    │ 00:08:20 │
│ 192.168.100.254 │ 08:00:27:e6:60:9c │ gateway       │ PCS Computer Systems GmbH │ 0 B    │ 0 B    │ 00:08:20 │
│                 │                   │               │                           │        │        │          │
│ 192.168.100.1   │ 0a:00:27:00:00:19 │               │                           │ 5.0 kB │ 9.3 kB │ 00:09:44 │
│ 192.168.100.252 │ 08:00:27:58:75:20 │               │ PCS Computer Systems GmbH │ 720 B  │ 552 B  │ 00:09:38 │
│ 192.168.100.253 │ 08:00:27:2e:6b:e6 │ companyrouter │ PCS Computer Systems GmbH │ 720 B  │ 552 B  │ 00:09:38 │
└─────────────────┴───────────────────┴───────────────┴───────────────────────────┴────────┴────────┴──────────┘

↑ 83 kB / ↓ 5.0 MB / 61350 pkts

192.168.100.0/24 > 192.168.100.166  »

192.168.100.0/24 > 192.168.100.166  » set arp.spoof.targets 192.168.100.252
192.168.100.0/24 > 192.168.100.166  » arp.spoof on
192.168.100.0/24 > 192.168.100.166  » [00:12:05] [sys.log] [inf] arp.spoof enabling forwarding
[00:12:05] [sys.log] [inf] arp.spoof arp spoofer started, probing 1 targets.



walt@remoteclient:~$ ping -c4 172.30.20.10
PING 172.30.20.10 (172.30.20.10) 56(84) bytes of data.
64 bytes from 172.30.20.10: icmp_seq=1 ttl=62 time=0.611 ms
64 bytes from 172.30.20.10: icmp_seq=2 ttl=62 time=1.48 ms
64 bytes from 172.30.20.10: icmp_seq=3 ttl=62 time=1.46 ms
64 bytes from 172.30.20.10: icmp_seq=4 ttl=62 time=1.08 ms

--- 172.30.20.10 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3010ms
rtt min/avg/max/mdev = 0.611/1.158/1.483/0.354 ms

192.168.100.0/24 > 192.168.100.166  » net.sniff on
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns FLAB2021 : A query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns fe80::af9f:830d:e2ec:682a : A query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns FLAB2021 : AAAA query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns fe80::af9f:830d:e2ec:682a : AAAA query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns FLAB2021 : A query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns fe80::af9f:830d:e2ec:682a : A query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns FLAB2021 : AAAA query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  » [00:14:02] [net.sniff.mdns] mdns fe80::af9f:830d:e2ec:682a : AAAA query for npi63b799.local
192.168.100.0/24 > 192.168.100.166  »


walt@remoteclient:~$ curl 172.30.20.10
<!DOCTYPE html>
<html>
<head>
    <title>Insecure Cyb</title>
</head>
<body>

<h1>Welcome to Insecure.cyb!</h1>
<img src="https://www.eff.org/files/banner_library/http_warning.png">

<h2>We learn what it means to be not secure :) </h2>

    <br />
<b>Warning</b>:  mysqli::__construct(): (HY000/2002): No route to host in <b>/var/www/html/index.php</b> on line <b>26</b><br />
<p>Error: Could not connect to the database</p>
    <!-- HTML Form -->
    <form method="POST" action="">
        <label for="login">Login:</label>
        <input type="text" name="login" id="login" />
        <input type="submit" value="Search" />
    </form>
</body>
</html>


walt@remoterouter:~$ ip neigh
192.168.100.166 dev eth1 lladdr 08:00:27:47:e5:58 REACHABLE
192.168.100.1 dev eth1 lladdr 0a:00:27:00:00:19 DELAY
192.168.100.253 dev eth1 lladdr 08:00:27:2e:6b:e6 REACHABLE
172.123.0.66 dev eth2 lladdr 08:00:27:99:d0:39 STALE
192.168.100.254 dev eth1 lladdr 08:00:27:47:e5:58 REACHABLE

[walt@companyrouter ~]$ ip neigh
172.30.0.66 dev eth1 INCOMPLETE
172.30.0.4 dev eth1 FAILED
192.168.100.254 dev eth0 lladdr 08:00:27:e6:60:9c STALE
172.30.20.10 dev eth3 lladdr 08:00:27:40:38:29 REACHABLE
172.30.0.15 dev eth1 FAILED
192.168.100.252 dev eth0 lladdr 08:00:27:58:75:20 STALE
192.168.100.166 dev eth0 lladdr 08:00:27:47:e5:58 REACHABLE
192.168.100.1 dev eth0 lladdr 0a:00:27:00:00:19 REACHABLE





vagrant@red:~$ sudo ettercap -Tq -i eth1 -M arp:remote /192.168.100.252// /192.168.100.253//

ettercap 0.8.3.1 copyright 2001-2020 Ettercap Development Team

Listening on:
  eth1 -> 08:00:27:47:E5:58
          192.168.100.166/255.255.255.0


SSL dissection needs a valid 'redir_command_on' script in the etter.conf file
Privileges dropped to EUID 65534 EGID 65534...

  34 plugins
  42 protocol dissectors
  57 ports monitored
28230 mac vendor fingerprint
1766 tcp OS fingerprint
2182 known services
Lua: no scripts were specified, not starting up!

Scanning for merged targets (2 hosts)...

* |==================================================>| 100.00 %

3 hosts added to the hosts list...

ARP poisoning victims:

 GROUP 1 : 192.168.100.252 08:00:27:58:75:20

 GROUP 2 : 192.168.100.253 08:00:27:2E:6B:E6
Starting Unified sniffing...


Text only Interface activated...
Hit 'h' for inline help




vagrant@red:~$ sudo ettercap -T -i eth1 -M arp:remote /192.168.100.252// /192.168.100.253// -L dumpfile -w zonderipsec.pcap

ettercap 0.8.3.1 copyright 2001-2020 Ettercap Development Team

Listening on:
  eth1 -> 08:00:27:47:E5:58
          192.168.100.166/255.255.255.0


SSL dissection needs a valid 'redir_command_on' script in the etter.conf file
Privileges dropped to EUID 65534 EGID 65534...

  34 plugins
  42 protocol dissectors
  57 ports monitored
28230 mac vendor fingerprint
1766 tcp OS fingerprint
2182 known services
Lua: no scripts were specified, not starting up!

Scanning for merged targets (2 hosts)...

* |==================================================>| 100.00 %

3 hosts added to the hosts list...

ARP poisoning victims:

 GROUP 1 : 192.168.100.252 08:00:27:58:75:20

 GROUP 2 : 192.168.100.253 08:00:27:2E:6B:E6
Starting Unified sniffing...


Text only Interface activated...
Hit 'h' for inline help



Mon Jan  8 00:48:51 2024 [474682]
  192.168.100.253:0 --> 192.168.100.252:0 |  (0)


...

Terminating ettercap...
Lua cleanup complete!
ARP poisoner deactivated.
RE-ARPing the victims...
Unified sniffing was stopped.

vagrant@red:~$ scp zonderipsec.pcap benny@192.168.100.1:/c:/data/git/ca/files
zonderipsec.pcap



walt@remoterouter:~$ cat tunnel.sh tunnel_R_to_C_begin.sh
#!/usr/bin/env sh

REMOTEROUTER='192.168.100.252'
COMPANYROUTER='192.168.100.253'

REMOTENET='172.123.0.0/24'
COMPANYNET='172.30.0.0/16'

# Manual IPSec

## Clean all previous IPsec stuff

ip xfrm policy flush
ip xfrm state flush

## The first SA vars for the tunnel from remoterouter to companyrouter

SPI7=0x007
ENCKEY7=0xFEDCBA9876543210FEDCBA9876543210

## Activate the tunnel from remoterouter to companyrouter

### Define the SA (Security Association)

ip xfrm state add \
    src ${REMOTEROUTER} \
    dst ${COMPANYROUTER} \
    proto esp \
    spi ${SPI7} \
    mode tunnel \
    enc aes ${ENCKEY7}

### Set up the SP using this SA

ip xfrm policy add \
    src ${REMOTENET} \
    dst ${COMPANYNET} \
    dir out \
    tmpl \
    src ${REMOTEROUTER} \
    dst ${COMPANYROUTER} \
    proto esp \
    spi ${SPI7} \
    mode tunnel




The ip xfrm state flush command is used to clear (flush) the Security Association Database (SAD) entries for the IPsec (IP Security) framework in Linux. The Security Association Database is a component of IPsec that stores information about active Security Associations (SAs). An SA represents the relationship between two communicating entities (typically hosts or network devices) and includes security parameters such as encryption keys and algorithms.

When you run ip xfrm state flush, it removes all the entries from the SAD. This means that any existing IPsec Security Associations are cleared, and the system essentially returns to a state where it has no active IPsec SAs.

Here's the basic syntax of the command:

bash
Copy code
sudo ip xfrm state flush
Flushing the SAD using this command will terminate existing IPsec connections, and new Security Associations will need to be established for subsequent IPsec traffic. Like the ip xfrm policy flush command for flushing the SPD, use this command with caution and ensure that you understand the impact on your network's security policies.

The ip xfrm policy flush command is used to clear (flush) the Security Policy Database (SPD) entries for the IPsec (IP Security) framework in Linux. IPsec is a suite of protocols that provides security services at the IP layer by authenticating and encrypting IP packets.

The Security Policy Database (SPD) is a component of the IPsec framework that stores policies for handling incoming and outgoing IPsec-protected traffic. These policies define how to process packets based on various criteria such as source and destination IP addresses, protocols, and port numbers.

When you run the ip xfrm policy flush command, it removes all the entries from the SPD. This means that any existing IPsec policies are cleared, and the system essentially returns to a state where it has no specific IPsec policies defined.

Here's the basic syntax of the command:

bash
Copy code
sudo ip xfrm policy flush
It's worth noting that flushing the SPD might disrupt existing IPsec connections or prevent new ones from being established until new policies are added. Use this command with caution, and make sure to have a clear understanding of the implications on your network's security policies.




root@remoterouter:~# ip xfrm state
src 192.168.100.252 dst 192.168.100.253
        proto esp spi 0x00000007 reqid 0 mode tunnel
        replay-window 0
        enc cbc(aes) 0xfedcba9876543210fedcba9876543210
        anti-replay context: seq 0x0, oseq 0x0, bitmap 0x00000000
        sel src 0.0.0.0/0 dst 0.0.0.0/0

root@remoterouter:~# ip xfrm policy
src 172.123.0.0/24 dst 172.30.0.0/16
        dir out priority 0 ptype main
        tmpl src 192.168.100.252 dst 192.168.100.253
                proto esp spi 0x00000007 reqid 0 mode tunnel



The command you provided is using the ip xfrm policy add command to add an IPsec Security Policy entry to the Security Policy Database (SPD) on a Linux system. This entry defines how to handle outbound IPsec traffic between a source network (${REMOTENET}) and a destination network (${COMPANYNET}).

Here's a breakdown of the command:

ip xfrm policy add: Initiates the addition of an IPsec policy to the Security Policy Database.

src ${REMOTENET}: Specifies the source network for the IPsec policy. The variable ${REMOTENET} likely contains the IP address or CIDR notation for the source network.

dst ${COMPANYNET}: Specifies the destination network for the IPsec policy. The variable ${COMPANYNET} likely contains the IP address or CIDR notation for the destination network.

dir out: Specifies the direction of the IPsec policy, which is outbound (out).

tmpl src ${REMOTEROUTER} dst ${COMPANYROUTER} proto esp spi ${SPI7} mode tunnel: Defines the template for the IPsec policy. This includes:

src ${REMOTEROUTER}: Specifies the source IP address of the remote router.
dst ${COMPANYROUTER}: Specifies the destination IP address of the company's router.
proto esp: Specifies the IPsec protocol used, which is Encapsulating Security Payload (ESP).
spi ${SPI7}: Specifies the Security Parameter Index (SPI), a unique identifier for the Security Association.
mode tunnel: Specifies that the IPsec mode is tunnel mode.
This command is essentially configuring an IPsec policy for outbound traffic from ${REMOTENET} to ${COMPANYNET}, using ESP in tunnel mode between the specified routers. The actual values for the variables, such as ${REMOTENET}, ${COMPANYNET}, ${REMOTEROUTER}, ${COMPANYROUTER}, and ${SPI7}, need to be replaced with the appropriate values for your specific network configuration.

Make sure to replace the variables with the actual values and ensure that the configuration aligns with your IPsec setup.








walt@remoterouter:~$ sudo apt install -yq xxd
Reading package lists...
Building dependency tree...
Reading state information...
The following NEW packages will be installed:
  xxd
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 83.7 kB of archives.
After this operation, 138 kB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bookworm/main amd64 xxd amd64 2:9.0.1378-2 [83.7 kB]
Fetched 83.7 kB in 0s (656 kB/s)
Selecting previously unselected package xxd.
(Reading database ... 55564 files and directories currently installed.)
Preparing to unpack .../xxd_2%3a9.0.1378-2_amd64.deb ...
Unpacking xxd (2:9.0.1378-2) ...
Setting up xxd (2:9.0.1378-2) ...
Processing triggers for man-db (2.11.2-2) ...


walt@remoterouter:~$ dd if=/dev/random count=24 bs=1 | xxd -ps
24+0 records in
24+0 records out
66696c33532cd73076d4ab3b8c07f68adbb2e8f01f40e38d
24 bytes copied, 0.00040296 s, 59.6 kB/s
walt@remoterouter:~$





he length of the AES encryption key used in IPsec depends on the key size specified for the particular encryption algorithm. AES supports key sizes of 128 bits, 192 bits, and 256 bits. Here's the correspondence between key sizes and the length of the hexadecimal representation:

128-bit key: 32 hexadecimal characters
192-bit key: 48 hexadecimal characters
256-bit key: 64 hexadecimal characters
When generating an AES key for IPsec, ensure that the key size aligns with the security requirements and configurations of your IPsec implementation. You should consult the documentation for your specific IPsec software or appliance to determine the supported key sizes.

Here's an example using openssl to generate a random AES key for IPsec:

For a 128-bit key:

bash
Copy code
openssl rand -hex 16
For a 192-bit key:

bash
Copy code
openssl rand -hex 24
For a 256-bit key:

bash
Copy code
openssl rand -hex 32
Remember to keep the generated key secure and distribute it securely to the systems participating in the IPsec communication.





walt@remoterouter:~$ sudo ip xfrm policy flush && sudo ip xfrm state flush
walt@remoterouter:~$ sudo ip xfrm policy && sudo ip xfrm state
walt@remoterouter:~$

[walt@companyrouter ~]$ sudo ip xfrm policy flush && sudo ip xfrm state flush
[walt@companyrouter ~]$ sudo ip xfrm policy && sudo ip xfrm state
[walt@companyrouter ~]$

















vagrant@red:~$ sudo ettercap -T -i eth1 -M arp:remote /192.168.100.252// /192.168.100.253// -L dumpfile -w bidirecttunnel.pcap

ettercap 0.8.3.1 copyright 2001-2020 Ettercap Development Team

Listening on:
  eth1 -> 08:00:27:47:E5:58
          192.168.100.166/255.255.255.0


SSL dissection needs a valid 'redir_command_on' script in the etter.conf file
Privileges dropped to EUID 65534 EGID 65534...

  34 plugins
  42 protocol dissectors
  57 ports monitored
28230 mac vendor fingerprint
1766 tcp OS fingerprint
2182 known services
Lua: no scripts were specified, not starting up!

Scanning for merged targets (2 hosts)...

* |==================================================>| 100.00 %

3 hosts added to the hosts list...

ARP poisoning victims:

 GROUP 1 : 192.168.100.252 08:00:27:58:75:20

 GROUP 2 : 192.168.100.253 08:00:27:2E:6B:E6
Starting Unified sniffing...

Mon Jan  8 11:32:13 2024 [116660]
  192.168.100.252:0 --> 192.168.100.253:0 |  (0)
Closing text interface...


Terminating ettercap...
Lua cleanup complete!
ARP poisoner deactivated.
RE-ARPing the victims...
Unified sniffing was stopped.

vagrant@red:~$ scp bidirecttunnel.pcap benny@192.168.100.1:/c:/data/git/ca/files
bidirecttunnel.pcap                                                                                                                                                            100%   59KB  28.6MB/s   00:00
vagrant@red:~$



[walt@companyrouter ~]$ sudo ip xfrm policy flush && sudo ip xfrm state flush
[walt@companyrouter ~]$ sudo ip xfrm policy && sudo ip xfrm state
[walt@companyrouter ~]$ sudo bash ./tunnelsC.sh
[walt@companyrouter ~]$ sudo ip xfrm policy && sudo ip xfrm state
src 172.30.0.0/16 dst 172.123.0.0/24
        dir out priority 0 ptype main
        tmpl src 192.168.100.253 dst 192.168.100.252
                proto esp spi 0x00000008 reqid 0 mode tunnel
src 172.123.0.0/24 dst 172.30.0.0/16
        dir fwd priority 0 ptype main
        tmpl src 192.168.100.252 dst 192.168.100.253
                proto esp spi 0x00000007 reqid 0 mode tunnel
src 192.168.100.253 dst 192.168.100.252
        proto esp spi 0x00000008 reqid 0 mode tunnel
        replay-window 0
        enc cbc(aes) 0x66696c33532cd73076d4ab3b8c07f68adbb2e8f01f40e38d
        lastused 2024-01-08 11:32:13
        anti-replay context: seq 0x0, oseq 0x13, bitmap 0x00000000
        sel src 0.0.0.0/0 dst 0.0.0.0/0
src 192.168.100.252 dst 192.168.100.253
        proto esp spi 0x00000007 reqid 0 mode tunnel
        replay-window 0
        enc cbc(aes) 0xfedcba9876543210fedcba9876543210
        lastused 2024-01-08 11:32:13
        anti-replay context: seq 0x0, oseq 0x0, bitmap 0x00000000
        sel src 0.0.0.0/0 dst 0.0.0.0/0
[walt@companyrouter ~]$

walt@remoterouter:~$ sudo ip xfrm policy && sudo ip xfrm state
src 172.30.0.0/16 dst 172.123.0.0/24
        dir fwd priority 0 ptype main
        tmpl src 192.168.100.253 dst 192.168.100.252
                proto esp spi 0x00000008 reqid 0 mode tunnel
src 172.123.0.0/24 dst 172.30.0.0/16
        dir out priority 0 ptype main
        tmpl src 192.168.100.252 dst 192.168.100.253
                proto esp spi 0x00000007 reqid 0 mode tunnel
src 192.168.100.253 dst 192.168.100.252
        proto esp spi 0x00000008 reqid 0 mode tunnel
        replay-window 0
        enc cbc(aes) 0x66696c33532cd73076d4ab3b8c07f68adbb2e8f01f40e38d
        anti-replay context: seq 0x0, oseq 0x0, bitmap 0x00000000
        sel src 0.0.0.0/0 dst 0.0.0.0/0
src 192.168.100.252 dst 192.168.100.253
        proto esp spi 0x00000007 reqid 0 mode tunnel
        replay-window 0
        enc cbc(aes) 0xfedcba9876543210fedcba9876543210
        anti-replay context: seq 0x0, oseq 0x17, bitmap 0x00000000
        sel src 0.0.0.0/0 dst 0.0.0.0/0


walt@remoteclient:~$ ping -c10 172.30.20.10
PING 172.30.20.10 (172.30.20.10) 56(84) bytes of data.
64 bytes from 172.30.20.10: icmp_seq=1 ttl=62 time=14.5 ms
64 bytes from 172.30.20.10: icmp_seq=2 ttl=62 time=11.7 ms
64 bytes from 172.30.20.10: icmp_seq=3 ttl=62 time=17.2 ms
64 bytes from 172.30.20.10: icmp_seq=4 ttl=62 time=15.8 ms
64 bytes from 172.30.20.10: icmp_seq=5 ttl=62 time=13.0 ms
64 bytes from 172.30.20.10: icmp_seq=6 ttl=62 time=11.2 ms
64 bytes from 172.30.20.10: icmp_seq=7 ttl=62 time=10.3 ms
64 bytes from 172.30.20.10: icmp_seq=8 ttl=62 time=16.4 ms
64 bytes from 172.30.20.10: icmp_seq=9 ttl=62 time=14.0 ms
64 bytes from 172.30.20.10: icmp_seq=10 ttl=62 time=11.9 ms

--- 172.30.20.10 ping statistics ---
10 packets transmitted, 10 received, 0% packet loss, time 9018ms
rtt min/avg/max/mdev = 10.261/13.594/17.178/2.233 ms
walt@remoteclient:~$ curl 172.30.20.10
<!DOCTYPE html>
<html>
<head>
    <title>Insecure Cyb</title>
</head>
<body>

<h1>Welcome to Insecure.cyb!</h1>
<img src="https://www.eff.org/files/banner_library/http_warning.png">

<h2>We learn what it means to be not secure :) </h2>

    <br />
<b>Warning</b>:  mysqli::__construct(): (HY000/2002): No route to host in <b>/var/www/html/index.php</b> on line <b>26</b><br />
<p>Error: Could not connect to the database</p>
    <!-- HTML Form -->
    <form method="POST" action="">
        <label for="login">Login:</label>
        <input type="text" name="login" id="login" />
        <input type="submit" value="Search" />
    </form>
</body>
</html>
walt@remoteclient:~$ curl 172.30.20.10/cmd
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Command Injection</title>
    <script src="assets/javascript/index.js"></script>
</head>
<body>
<h1>Command Injection</h1>
<form id="ping">
    <h2>Ping a device</h2>
    <label for="ip">Enter an IP address</label>
    <input id="ip" type="text"/>
    <input type="submit" value="PING">
</form>

<form id="exec">
    <h2>Execute a command</h2>
    <label for="cmd">Enter a command</label>
    <input id="cmd" type="text"/>
    <input type="submit" value="EXEC">
</form>

<pre></pre>
</body>
</html>
walt@remoteclient:~$




[walt@companyrouter ~]$ sudo ip xfrm monitor
Async event  (0x10)  replay update
        src 192.168.100.253 dst 192.168.100.252  reqid 0x0 protocol esp  SPI 0x8
Async event  (0x10)  replay update
        src 192.168.100.253 dst 192.168.100.252  reqid 0x0 protocol esp  SPI 0x8
Async event  (0x10)  replay update
        src 192.168.100.253 dst 192.168.100.252  reqid 0x0 protocol esp  SPI 0x8
Async event  (0x20)  timer expired
        src 192.168.100.253 dst 192.168.100.252  reqid 0x0 protocol esp  SPI 0x8
Async event  (0x20)  timer expired
        src 192.168.100.253 dst 192.168.100.252  reqid 0x0 protocol esp  SPI 0x8




walt@remoteclient:~$ mysql -utoor -psummer -h172.30.0.15 -e "SELECT user, host FROM mysql.user;"
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------+-----------+
| user             | host      |
+------------------+-----------+
| sammy            | %         |
| toor             | %         |
| mysql.infoschema | localhost |
| mysql.session    | localhost |
| mysql.sys        | localhost |
| root             | localhost |
+------------------+-----------+




walt@remoteclient:~$ mysql -utoor -psummer -h172.30.0.15 -e "SELECT user, host FROM mysql.user;"
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------+-----------+
| user             | host      |
+------------------+-----------+
| sammy            | %         |
| toor             | %         |
| mysql.infoschema | localhost |
| mysql.session    | localhost |
| mysql.sys        | localhost |
| root             | localhost |
+------------------+-----------+

vagrant@red:~$ mysql -utoor -psummer -h172.30.0.15 -e "SELECT user, host FROM mysql.user;"
ERROR 2002 (HY000): Can't connect to server on '172.30.0.15' (115)



        chain benny_forward {
                type filter hook forward priority filter; policy accept;
                counter packets 70 bytes 8075
                ct state invalid counter packets 0 bytes 0 drop
                ct state established,related counter packets 30 bytes 5675 accept
                ip saddr @internal_range ip protocol icmp add @allowed_fwd_pings { ip saddr . ip daddr } accept
                ip protocol icmp add @dropped_fwd_pings { ip saddr . ip daddr } drop
                ip saddr @super_internal_range counter packets 38 bytes 2280 accept
                ct state new tcp dport 80 ip daddr 172.30.20.10 add @forwarded_tcp_connections { ip saddr . ip daddr . tcp sport . tcp dport } accept
                ct state new tcp dport 699 ip daddr 172.30.20.20 add @forwarded_tcp_connections { ip saddr . ip daddr . tcp sport . tcp dport } accept
                ct state new ip saddr @internal_range tcp dport 22 add @forwarded_tcp_connections { ip saddr . ip daddr . tcp sport . tcp dport } accept
                ct state new add @forwarded_dropped_tcp_connections { ip saddr . ip daddr . tcp sport . tcp dport } reject
                ct state new udp dport { 53, 123 } add @forwarded_udp_connections_accepted { ip saddr . ip daddr . udp dport } accept
                ct state new udp dport != { 53, 123 } add @forwarded_udp_connections_rejected { ip saddr . ip daddr . udp dport }
                ct state new add @all_rejected { ip saddr . ip daddr . ip protocol . tcp dport . ct state }
                counter packets 0 bytes 0 reject
        }

        set forwarded_dropped_tcp_connections {
                typeof ip saddr . ip daddr . tcp sport . tcp dport
                size 65535
                flags dynamic
                counter
                elements = { 192.168.100.166 . 172.30.0.15 . 47120 . 3306 counter packets 1 bytes 60,
                             192.168.100.166 . 172.30.0.15 . 54558 . 3306 counter packets 1 bytes 60 }
        }




[walt@companyrouter windows]$ scp ca.crt benny@192.168.100.1:/c:/users/benny/openvpn/config
benny@192.168.100.1's password:
ca.crt                                                                                                                                                                         100% 1196     1.1MB/s   00:00
[walt@companyrouter windows]$ scp winclient.crt benny@192.168.100.1:/c:/users/benny/openvpn/config
benny@192.168.100.1's password:
winclient.crt                                                                                                                                                                  100% 4510     5.8MB/s   00:00
[walt@companyrouter windows]$ scp winclient.key benny@192.168.100.1:/c:/users/benny/openvpn/config
benny@192.168.100.1's password:
winclient.key                                                                                                                                                                  100% 1704     2.6MB/s   00:00
[walt@companyrouter windows]$ scp winclient.ovpn benny@192.168.100.1:/c:/users/benny/openvpn/config
benny@192.168.100.1's password:
winclient.ovpn                                                                                                                                                                 100%  202   359.9KB/s   00:00
[walt@companyrouter windows]$ cat winclient.ovpn
client
dev tun
proto udp
remote 192.168.100.253 1194
resolv-retry infinite
nobind
persist-key
persist-tun
ca ca.crt
cert winclient.crt
key winclient.key
remote-cert-tls server
cipher AES-256-GCM
verb 3



